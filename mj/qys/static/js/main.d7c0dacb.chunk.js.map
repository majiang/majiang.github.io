{"version":3,"sources":["gamecommon.ts","common.ts","hu.ts","deal.ts","components.tsx","redux-logic-helper.ts","gamelogics.ts","App.js","serviceWorker.js","index.js"],"names":["rank","tile","shufflePile","m","ranks","pile","Array","from","keys","i","Math","floor","random","appendMessage","messages","newMessage","length","slice","range","n","isNormalHu","hand","entries","handCopied","isSets","gamecommon","c","isPairs","sets","pairs","nullDeal","p","started","discardTile","deal","position","splice","drawTile","push","dealHand","sortHand","console","log","sort","a","b","ret","newDeal","shuffle","date","huValidator","allowPairs","count","isPairsWithHog","tileClass","theme","tileStyle","tileSuit","PostModernBamboos","PostModernCharacters","PostModernDots","GLMahjongTileBamboos","GLMahjongTileCharacters","GLMahjongTileDots","tileHeight","Game","props","handleWindowResize","window","innerWidth","setState","windowInnerWidth","handleTimeRestChanged","timeRest","valueOf","state","settings","timeOfGame","Date","handleHandLengthChanged","e","handLength","parseInt","target","value","handleTileStyleChanged","handleTileSuitChanged","handleAllowPairsChanged","handleTimeBeforeDrawChanged","timeBeforeDraw","handleTimeBeforeSortChanged","timeBeforeSort","handleTimeOfGameChanged","declareHu","actions","validator","next","initializer","directDiscardAndDraw","discardAndDraw","resetGame","first","handleKeydown","keyCode","preventDefault","findIndex","index","displayTime","document","addEventListener","this","setInterval","removeEventListener","clearInterval","maxTiles","discard","width","score","time","hu","reset","handler","React","Component","Hand","key","onClick","scale","height","map","renderTile","HandOuter","className","style","children","HandInner","transformOrigin","transform","Tile","src","imageUrl","generateStyle","alt","toString","TypeError","r","PostModernTile","clip","top","right","bottom","left","GLMahjongTile","suit","Status","v","Controls","toFixed","choices","display","formatDigits","name","defaultValue","onChange","id","label","min","max","step","default","renderHuButton","renderStatus","renderStartButton","renderHandLength","renderTileStyle","renderTileSuit","renderAllowPairs","renderTimeBeforeDraw","renderTimeBeforeSort","renderTimeOfGame","Radios","Radio","type","defaultChecked","htmlFor","Range","StartButton","HuButton","d","l","repeat","createLogic","actionCreator","config","_createLogic","process","dispatch","done","action","getState","isType","validate","undefined","actionCreatorFactory","nullGame","gameActions","draw","resetAndDraw","newGame","sortAndDraw","scoreHu","scoreCuohu","finish","gameReducer","reducerWithInitialState","case","payload","_","message","sqrt","tbd","dispatchWaitDispatch","firstAction","waitTimeMs","secondAction","setTimeout","discardAndDrawLogic","timeBetweenSortDraw","nextAction","resetAndDrawLogic","sortAndDrawLogic","logics","latest","warnTimeout","fill","forEach","fromTiles","dispatchSequence","gameStore","createStore","applyMiddleware","createLogicMiddleware","ConnectedGame","connect","storeState","bindActionCreators","App","store","Boolean","location","hostname","match","ReactDOM","render","StrictMode","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","error"],"mappings":"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","file":"static/js/main.d7c0dacb.chunk.js","sourcesContent":["export type Hand = Array<number>;\r\nexport type Pile = Array<number>;\r\nexport type Tile = number;\r\nexport const ranks = 9;\r\nexport const duplicates = 4;\r\nexport const deck = ranks * duplicates;\r\nexport function rank(tile: Tile): number\r\n{\r\n    return ~~(tile/duplicates);\r\n}\r\nexport function shufflePile(): Pile\r\n{\r\n  let m = deck;\r\n  let pile = Array.from(Array(m).keys());\r\n  while (m)\r\n  {\r\n    const i = Math.floor(Math.random() * (m--));\r\n    [pile[i], pile[m]] = [pile[m], pile[i]];\r\n  }\r\n  return pile;\r\n}\r\nexport const setSize = 3;\r\nexport const pairSize = 2;\r\nexport type Message = [number, string];\r\nexport type Messages = Array<Message>;\r\nexport function appendMessage(messages: Messages, newMessage: string): Messages\r\n{\r\n  if (messages.length === 0) return [[0, newMessage]];\r\n  const ret: Messages = [...messages, [messages[messages.length-1][0]+1, newMessage]];\r\n  return ret.slice(-4);\r\n}\r\n","export function* range(n: number)\r\n{\r\n  for (let i = 0; i < n; i++) yield i;\r\n}\r\n","import * as gamecommon from './gamecommon';\r\nimport { range } from './common';\r\n\r\nexport function fromTiles(hand: gamecommon.Hand): Array<number>\r\n{\r\n  let ret = new Array(gamecommon.ranks).fill(0);\r\n  hand.forEach(tile => {ret[gamecommon.rank(tile)] += 1});\r\n  return ret;\r\n}\r\n\r\nexport type Validator = (hand: Array<number>) => boolean;\r\n\r\nexport function isNormalHu(hand: Array<number>): boolean\r\n{\r\n  for (const [rank, count] of hand.entries())\r\n  {\r\n    if (count < gamecommon.pairSize)\r\n    continue;\r\n    let handCopied = [...hand];\r\n    handCopied[rank] -= gamecommon.pairSize;\r\n    if (isSets(handCopied)) return true;\r\n  }\r\n  return false;\r\n}\r\n\r\nexport function isSets(hand: Array<number>): boolean\r\n{\r\n  for (const rank of range(gamecommon.ranks - gamecommon.setSize + 1))\r\n  {\r\n    if (hand[rank] < 0) return false;\r\n    hand[rank] %= gamecommon.setSize;\r\n    const c = hand[rank];\r\n    for (const d of range(gamecommon.setSize))\r\n    {\r\n      hand[rank + d] -= c;\r\n    }\r\n  }\r\n  for (const count of hand)\r\n  {\r\n    if (count % gamecommon.setSize) return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nexport function isPairs(hand: Array<number>): boolean\r\n{\r\n  let sets = 0;\r\n  let pairs = 0;\r\n  for (const count of hand)\r\n  {\r\n    switch (count)\r\n    {\r\n      case 0: continue;\r\n      case gamecommon.setSize: sets += 1; continue;\r\n      case gamecommon.pairSize: pairs += 1; continue;\r\n      default: return false;\r\n    }\r\n  }\r\n  return (sets <= 1) && (pairs % gamecommon.setSize === 1);\r\n}\r\n\r\nexport function isPairsWithHog(hand: Array<number>): boolean\r\n{\r\n  let sets = 0;\r\n  let pairs = 0;\r\n  for (const count of hand)\r\n  {\r\n    if (count === gamecommon.setSize)\r\n    {\r\n      sets += 1;\r\n      continue;\r\n    }\r\n    if (count % gamecommon.pairSize)\r\n      return false;\r\n    pairs += count / gamecommon.pairSize;\r\n  }\r\n  return (sets <= 1) && (pairs % gamecommon.setSize === 1);\r\n}\r\n","import { Hand, Pile, shufflePile } from './gamecommon';\r\nexport type Deal =\r\n{\r\n  hand: Hand,\r\n  p: number,\r\n  pile: Pile,\r\n  started: Date | null,\r\n};\r\nexport const nullDeal: Deal =\r\n{\r\n  hand: [],\r\n  p: 0,\r\n  pile: [],\r\n  started: null,\r\n};\r\nexport function discardTile(deal: Deal, position: number)\r\n{\r\n  let hand = [...deal.hand];\r\n  hand.splice(position, 1);\r\n  return {...deal,\r\n    hand,\r\n  };\r\n}\r\nexport function drawTile(deal: Deal)\r\n{\r\n  let hand = [...deal.hand];\r\n  hand.push(deal.pile[deal.p]);\r\n  return {...deal,\r\n    hand,\r\n    p: deal.p+1,\r\n  };\r\n}\r\nexport function dealHand(deal: Deal): Deal\r\n{\r\n  return {...deal,\r\n    hand: deal.pile.slice(0, deal.p),\r\n  };\r\n}\r\nexport function sortHand(deal: Deal): Deal\r\n{\r\n  console.log(deal);\r\n  let hand = [...deal.hand];\r\n  hand.sort((a, b) => (a - b));\r\n  const ret = {...deal,\r\n    hand,\r\n  };\r\n  console.log(ret);\r\n  return ret;\r\n}\r\nexport function newDeal(shuffle: () => Pile, date: () => Date, p: number): Deal\r\n{\r\n  const pile = shufflePile();\r\n  const started = date();\r\n  return dealHand({...nullDeal,\r\n    p,\r\n    pile,\r\n    started,\r\n  });\r\n}\r\n","import React from 'react';\r\nimport * as gamecommon from './gamecommon';\r\nimport { isNormalHu, isPairs, isPairsWithHog, Validator } from './hu';\r\nimport { gameActions } from './gamelogics';\r\nimport { Deal, newDeal } from './deal';\r\n\r\ntype AllowPairs = \"disallow\" | \"allow\" | \"allow-hog\";\r\ntype TileStyle = \"PostModern\" | \"GLMahjongTile\";\r\ntype TileSuit = \"bamboos\" | \"characters\" | \"dots\";\r\n\r\ntype GameProps =\r\n{\r\n  initializer: ()=>Array<number>,\r\n  deal: Deal,\r\n  actions: typeof gameActions,\r\n  score: number | null,\r\n  started: Date | null,\r\n  messages: Array<[number, string]>\r\n};\r\ntype Settings =\r\n{\r\n  handLength: number,\r\n  allowPairs: AllowPairs,\r\n  timeBeforeDraw: number,\r\n  timeBeforeSort: number,\r\n  timeOfGame: number,\r\n};\r\nfunction huValidator(allowPairs: AllowPairs): Validator\r\n{\r\n  switch (allowPairs)\r\n  {\r\n    case 'disallow': return isNormalHu;\r\n    case 'allow': return (hand) => isNormalHu(hand) || isPairs(hand);\r\n    case 'allow-hog': return (hand) => isNormalHu(hand) || isPairs(hand) || isPairsWithHog(hand);\r\n  }\r\n}\r\ntype Theme =\r\n{\r\n  tileStyle: TileStyle,\r\n  tileSuit: TileSuit,\r\n}\r\nfunction tileClass(theme: Theme): React.ComponentClass<TileProps>\r\n{\r\n  switch (theme.tileStyle)\r\n  {\r\n    case 'PostModern': switch (theme.tileSuit)\r\n    {\r\n      case 'bamboos': return PostModernBamboos;\r\n      case 'characters': return PostModernCharacters;\r\n      case 'dots': return PostModernDots;\r\n    }\r\n    case 'GLMahjongTile': switch (theme.tileSuit)\r\n    {\r\n      case 'bamboos': return GLMahjongTileBamboos;\r\n      case 'characters': return GLMahjongTileCharacters;\r\n      case 'dots': return GLMahjongTileDots;\r\n    }\r\n  }\r\n}\r\nfunction tileHeight(theme: Theme): number\r\n{\r\n  switch (theme.tileStyle)\r\n  {\r\n    case 'PostModern': return 88;\r\n    case 'GLMahjongTile': return 91;\r\n  }\r\n}\r\ntype GameState =\r\n{\r\n  settings: Settings,\r\n  theme: Theme,\r\n  timeRest: number | null,\r\n  displayTime: NodeJS.Timeout | null,\r\n  windowInnerWidth: number,\r\n};\r\n\r\nexport class Game extends React.Component<GameProps, GameState>\r\n{\r\n  constructor (props: GameProps)\r\n  {\r\n    super (props);\r\n    this.state = {\r\n      settings: {\r\n        handLength: 13,\r\n        allowPairs: \"allow\",\r\n        timeBeforeDraw: 1000,\r\n        timeBeforeSort: 500,\r\n        timeOfGame: 60000,\r\n      },\r\n      theme: {\r\n        tileStyle: \"PostModern\",\r\n        tileSuit: \"dots\",\r\n      },\r\n      timeRest: null,\r\n      displayTime: null,\r\n      windowInnerWidth: window.innerWidth,\r\n    };\r\n  }\r\n  handleWindowResize = () => {\r\n    console.log(`windowInnerWidth: ${window.innerWidth}`);\r\n    this.setState({windowInnerWidth: window.innerWidth});\r\n  }\r\n  handleTimeRestChanged = () => {\r\n    if (this.props.started == null)\r\n      return;\r\n    let timeRest = this.props.started.valueOf() + this.state.settings.timeOfGame - new Date().valueOf();\r\n    if (timeRest < 0) timeRest = 0;\r\n    this.setState({timeRest});\r\n  };\r\n  handleHandLengthChanged = (e: React.ChangeEvent<HTMLInputElement>) =>\r\n  {\r\n    this.setState({settings: {...this.state.settings, handLength: parseInt(e.target.value)}});\r\n  };\r\n  handleTileStyleChanged = (e: React.ChangeEvent<HTMLInputElement>) =>\r\n  {\r\n    this.setState({theme: {...this.state.theme, tileStyle: e.target.value as TileStyle}});\r\n  };\r\n  handleTileSuitChanged = (e: React.ChangeEvent<HTMLInputElement>) =>\r\n  {\r\n    this.setState({theme: {...this.state.theme, tileSuit: e.target.value as TileSuit}});\r\n  };\r\n  handleAllowPairsChanged = (e: React.ChangeEvent<HTMLInputElement>) =>\r\n  {\r\n    this.setState({settings: {...this.state.settings, allowPairs: e.target.value as AllowPairs}});\r\n  }\r\n  handleTimeBeforeDrawChanged = (e: React.ChangeEvent<HTMLInputElement>) =>\r\n  {\r\n    this.setState({settings: {...this.state.settings, timeBeforeDraw: parseInt(e.target.value)}});\r\n  };\r\n  handleTimeBeforeSortChanged = (e: React.ChangeEvent<HTMLInputElement>) =>\r\n  {\r\n    this.setState({settings: {...this.state.settings, timeBeforeSort: parseInt(e.target.value)}});\r\n  };\r\n  handleTimeOfGameChanged = (e: React.ChangeEvent<HTMLInputElement>) =>\r\n  {\r\n    this.setState({settings: {...this.state.settings, timeOfGame: parseInt(e.target.value)}});\r\n  };\r\n  declareHu = () =>\r\n  {\r\n    return this.props.actions.declareHu({\r\n      validator: huValidator(this.state.settings.allowPairs),\r\n      next: newDeal(this.props.initializer, (() => new Date()), this.state.settings.handLength),\r\n      timeBeforeDraw: this.state.settings.timeBeforeDraw,\r\n      timeBeforeSort: this.state.settings.timeBeforeSort,\r\n    });\r\n  };\r\n  directDiscardAndDraw = () =>\r\n  {\r\n    return this.discardAndDraw(this.props.deal.hand.length - 1);\r\n  };\r\n  discardAndDraw = (position: number) =>\r\n  {\r\n    return this.props.actions.discardAndDraw({\r\n      position: position,\r\n      timeBeforeDraw: this.state.settings.timeBeforeDraw,\r\n      timeBeforeSort: this.state.settings.timeBeforeSort});\r\n  };\r\n  resetGame = () =>\r\n  {\r\n    return this.props.actions.resetGame({\r\n      first: newDeal(this.props.initializer, (() => new Date()), this.state.settings.handLength),\r\n      timeBeforeDraw: this.state.settings.timeBeforeDraw,\r\n      timeBeforeSort: this.state.settings.timeBeforeSort,\r\n      timeOfGame: this.state.settings.timeOfGame,\r\n    });\r\n  };\r\n  handleKeydown = (e: KeyboardEvent) =>\r\n  {\r\n    if (e.keyCode === 32) // space: hu\r\n    {\r\n      e.preventDefault();\r\n      return this.declareHu();\r\n    }\r\n    if (e.keyCode < 48) return;\r\n    if (e.keyCode === 48) // 0: drawn\r\n    {\r\n      return this.directDiscardAndDraw();\r\n    }\r\n    if (e.keyCode === 83) // s: start\r\n    {\r\n      return this.resetGame();\r\n    }\r\n    if (58 <= e.keyCode) return;\r\n    console.log(`keyCode: ${e.keyCode}`);\r\n    let rank = e.keyCode - 49;\r\n    console.log(`rank: ${rank}`);\r\n    let position = this.props.deal.hand.findIndex((tile, index) => {\r\n      console.log(`${index}: ${tile}`);\r\n      return (gamecommon.rank(tile) === rank);\r\n    });\r\n    console.log(`position: ${position}`);\r\n    if (0 <= position)\r\n      return this.discardAndDraw(position);\r\n  };\r\n  componentDidMount()\r\n  {\r\n    document.addEventListener(\"keydown\", this.handleKeydown);\r\n    this.setState({displayTime: setInterval(this.handleTimeRestChanged, 10)});\r\n    window.addEventListener('resize', this.handleWindowResize);\r\n  }\r\n  componentWillUnmount()\r\n  {\r\n    document.removeEventListener(\"keydown\", this.handleKeydown);\r\n    clearInterval(this.state.displayTime!);\r\n    window.removeEventListener('resize', this.handleWindowResize);\r\n  }\r\n  render()\r\n  {\r\n    return <>\r\n        <Hand theme={this.state.theme} hand={this.props.deal.hand}\r\n          tileClass={tileClass(this.state.theme)}\r\n          maxTiles={this.state.settings.handLength+1}\r\n          discard={this.discardAndDraw}\r\n          width={this.state.windowInnerWidth} />\r\n        <Controls\r\n          score={this.props.score}\r\n          time={this.state.timeRest}\r\n          hu={this.declareHu}\r\n          reset={this.resetGame}\r\n          handLength={{handler: this.handleHandLengthChanged}}\r\n          tileStyle={{handler: this.handleTileStyleChanged}}\r\n          tileSuit={{handler: this.handleTileSuitChanged}}\r\n          allowPairs={{handler: this.handleAllowPairsChanged}}\r\n          timeBeforeDraw={{handler: this.handleTimeBeforeDrawChanged, value: this.state.settings.timeBeforeDraw}}\r\n          timeBeforeSort={{handler: this.handleTimeBeforeSortChanged, value: this.state.settings.timeBeforeSort}}\r\n          timeOfGame={{handler: this.handleTimeOfGameChanged, value: this.state.settings.timeOfGame}}\r\n        />\r\n        <Status messages={this.props.messages} />\r\n    </>;\r\n  }\r\n}\r\n\r\ntype HandProps =\r\n{\r\n  hand: gamecommon.Hand,\r\n  maxTiles: number,\r\n  theme: Theme,\r\n  tileClass: React.ComponentClass<TileProps>,\r\n  discard: (position: number) => void,\r\n  width: number,\r\n};\r\nclass Hand extends React.Component<HandProps>\r\n{\r\n  constructor (props: HandProps)\r\n  {\r\n    super (props);\r\n  }\r\n  renderTile(i: number, tile: gamecommon.Tile)\r\n  {\r\n    return (<this.props.tileClass key={tile} rank={gamecommon.rank(tile)} onClick={()=>this.props.discard(i)}/>);\r\n  }\r\n  render()\r\n  {\r\n    console.log(this.state);\r\n    return <HandOuter scale={this.props.width / (64 * this.props.maxTiles)} height={tileHeight(this.props.theme)}>\r\n      <HandInner width={64*this.props.maxTiles} scale={this.props.width / (64 * this.props.maxTiles)}>\r\n        {this.props.hand.map((tile, i)=>this.renderTile(i, tile))}\r\n        </HandInner></HandOuter>;\r\n  }\r\n}\r\n\r\nclass HandOuter extends React.Component<{scale: number, height: number}>\r\n{\r\n  render()\r\n  {\r\n    return <div className=\"hand-container\" style={{\r\n      height: `${this.props.scale * this.props.height}px`\r\n    }}>{this.props.children}</div>;\r\n  }\r\n}\r\nclass HandInner extends React.Component<{width: number, scale: number}>\r\n{\r\n  render()\r\n  {\r\n    return <div className=\"hand\" style={{\r\n      width: `${this.props.width}px`,\r\n      transformOrigin: 'top left',\r\n      transform: `scale(${this.props.scale})`,\r\n    }}>{this.props.children}</div>;\r\n  }\r\n}\r\n\r\ntype TileProps =\r\n{\r\n  rank: number,\r\n  onClick: () => void,\r\n};\r\n\r\nclass Tile extends React.Component<TileProps>\r\n{\r\n  render()\r\n  {\r\n    return <div className={`tile ${this.tileClass()}`} onClick={this.props.onClick}>\r\n      <img src={this.imageUrl()}\r\n      style={this.generateStyle(this.props.rank)}\r\n      alt={(this.props.rank+1).toString()}/></div>\r\n  }\r\n  tileClass(): string\r\n  {\r\n    throw new TypeError(\"tileClass() is not implemented\");\r\n  }\r\n  imageUrl(): string\r\n  {\r\n    throw new TypeError(\"imageUrl() is not implemented\");\r\n  }\r\n  generateStyle(r: number): any{throw new TypeError(\"\");}\r\n}\r\n\r\nclass PostModernTile extends Tile\r\n{\r\n  generateStyle(r: number)\r\n  {\r\n    return {\r\n        clip: `rect(${this.top(r)}, ${this.right(r)}, ${this.bottom(r)}, ${this.left(r)})`,\r\n        top: -this.top(r),\r\n        left: -this.left(r),\r\n    };\r\n  }\r\n  tileClass()\r\n  {\r\n    return 'pm';\r\n  }\r\n  right(r: number): number{throw new TypeError(\"right() is not implemented\");}\r\n  left(r: number): number{throw new TypeError(\"left() is not implemented\");}\r\n  top(r: number){return 0;}\r\n  bottom(r: number){return 88;}\r\n  imageUrl()\r\n  {\r\n    return \"postmodern.svg\";\r\n  }\r\n}\r\n\r\nclass PostModernBamboos extends PostModernTile\r\n{\r\n  left(r: number){return (24+r)*64;}\r\n  right(r: number){return (25+r)*64;}\r\n}\r\n\r\nclass PostModernCharacters extends PostModernTile\r\n{\r\n  left(r: number){return (15+r)*64;}\r\n  right(r: number){return (16+r)*64;}\r\n}\r\n\r\nclass PostModernDots extends PostModernTile\r\n{\r\n  left(r: number){return (0+r)*64;}\r\n  right(r: number){return (1+r)*64;}\r\n}\r\n\r\nclass GLMahjongTile extends Tile\r\n{\r\n  suit(): string{throw new TypeError(\"suit() is not implemented\");}\r\n  imageUrl()\r\n  {\r\n    return `gl-mahjongtile-svg/${this.suit()}-${this.props.rank}.svg`;\r\n  }\r\n  tileClass()\r\n  {\r\n    return 'gl';\r\n  }\r\n  generateStyle(r: number)\r\n  {\r\n    return {\r\n      transform: 'scale(1, -1)',\r\n    };\r\n  }\r\n}\r\n\r\nclass GLMahjongTileBamboos extends GLMahjongTile\r\n{\r\n  suit()\r\n  {\r\n    return 'b';\r\n  }\r\n}\r\n\r\nclass GLMahjongTileCharacters extends GLMahjongTile\r\n{\r\n  suit()\r\n  {\r\n    return 'c';\r\n  }\r\n}\r\n\r\nclass GLMahjongTileDots extends GLMahjongTile\r\n{\r\n  suit()\r\n  {\r\n    return 'd';\r\n  }\r\n}\r\n\r\ntype StatusProps =\r\n{\r\n  messages: Array<[number, string]>\r\n};\r\nclass Status extends React.Component<StatusProps>\r\n{\r\n  render()\r\n  {\r\n    return <ul className=\"status\">\r\n      {this.props.messages.map((v) => <li key={v[0]}>{v[1]}</li>)}\r\n    </ul>;\r\n  }\r\n}\r\n\r\ntype Handler = (e: React.ChangeEvent<HTMLInputElement>) => void;\r\ntype HasHandler =\r\n{\r\n  handler: Handler\r\n};\r\ntype HasHandlerAndValue =\r\n{\r\n  handler: Handler,\r\n  value: any,\r\n}\r\ntype ControlsProps =\r\n{\r\n  reset: () => void,\r\n  hu: () => void,\r\n  score: number | null,\r\n  time: number | null,\r\n  handLength: HasHandler,\r\n  tileStyle: HasHandler,\r\n  tileSuit: HasHandler,\r\n  allowPairs: HasHandler,\r\n  timeBeforeDraw: HasHandlerAndValue,\r\n  timeBeforeSort: HasHandlerAndValue,\r\n  timeOfGame: HasHandlerAndValue,\r\n};\r\n\r\nclass Controls extends React.Component<ControlsProps>\r\n{\r\n  renderHuButton()\r\n  {\r\n    return <HuButton onClick={this.props.hu} />;\r\n  }\r\n  renderStatus()\r\n  {\r\n    return <div className=\"status-labels\">\r\n      <div className=\"status-label\">{(this.props.score == null) ? `` : `score: ${~~(this.props.score * 1000)}`}</div>\r\n      <div className=\"status-label\">{(this.props.time == null) ? `` : `time: ${this.props.time.toFixed(2)}`}</div>\r\n    </div>;\r\n  }\r\n  renderStartButton()\r\n  {\r\n    return <StartButton onClick={this.props.reset} />;\r\n  }\r\n  renderHandLength()\r\n  {\r\n    return <fieldset className=\"hand-length\">\r\n        <span className=\"radio-label\">#tiles</span>\r\n        <Radios choices={[1, 4, 7, 10, 13, 16].map((v) =>\r\n          ({display: formatDigits(v, 2), value: v}))}\r\n          name=\"hand-length\"\r\n          defaultValue={13}\r\n          onChange={this.props.handLength.handler} />\r\n        </fieldset>;\r\n  }\r\n  renderTileStyle()\r\n  {\r\n    return <fieldset className=\"tile-style\">\r\n        <span className=\"radio-label\">tile style</span>\r\n        <Radios choices={[\r\n          {display: \"PostModern\", value: \"PostModern\"},\r\n          {display: \"GL-MT\", value: \"GLMahjongTile\"}]}\r\n          name=\"tile-style\"\r\n          defaultValue=\"PostModern\"\r\n          onChange={this.props.tileStyle.handler} />\r\n        </fieldset>;\r\n  }\r\n  renderTileSuit()\r\n  {\r\n    return <fieldset className=\"tile-suit\">\r\n        <span className=\"radio-label\">suit</span>\r\n        <Radios choices={[\r\n          {display: \"bams/索/条\", value: \"bamboos\"},\r\n          {display: \"chars/萬/万\", value: \"characters\"},\r\n          {display: \"dots/筒/饼\", value: \"dots\"}]}\r\n          name=\"tile-suit\"\r\n          defaultValue=\"dots\"\r\n          onChange={this.props.tileSuit.handler} />\r\n        </fieldset>;\r\n  }\r\n  renderAllowPairs()\r\n  {\r\n    return <fieldset className=\"allow-pairs\">\r\n        <span className=\"radio-label\">pairs</span>\r\n        <Radios choices={[\r\n          {display: \"disallow\", value: \"disallow\"},\r\n          {display: \"allow\", value: \"allow\"},\r\n          {display: \"tile hog\", value: \"allow-hog\"}]}\r\n          name=\"allow-pairs\"\r\n          defaultValue=\"allow\"\r\n          onChange={this.props.allowPairs.handler} />\r\n        </fieldset>;\r\n  }\r\n  renderTimeBeforeDraw()\r\n  {\r\n    return <fieldset><Range\r\n        id=\"time-before-draw\"\r\n        label=\"time before draw\"\r\n        handler={this.props.timeBeforeDraw.handler}\r\n        value={{\r\n          min: 100,\r\n          max: 9900,\r\n          step: 100,\r\n          default: 1000,\r\n          display: (this.props.timeBeforeDraw.value/1000).toFixed(1)+\"s\",\r\n        }} /></fieldset>;\r\n  }\r\n  renderTimeBeforeSort()\r\n  {\r\n    return <fieldset><Range\r\n        id=\"time-before-sort\"\r\n        label=\"time before sort\"\r\n        handler={this.props.timeBeforeSort.handler}\r\n        value={{\r\n          min: 0,\r\n          max: 9900,\r\n          step: 100,\r\n          default: 500,\r\n          display: (this.props.timeBeforeSort.value/1000).toFixed(1)+\"s\",\r\n        }} /></fieldset>\r\n  }\r\n  renderTimeOfGame()\r\n  {\r\n    return <fieldset><Range\r\n        id=\"time-of-game\"\r\n        label=\"time of game\"\r\n        handler={this.props.timeOfGame.handler}\r\n        value={{\r\n          min: 30000,\r\n          max: 600000,\r\n          step: 1000,\r\n          default: 60000,\r\n          display: <>{formatDigits(this.props.timeOfGame.value/1000, 3)}s</>,\r\n        }}\r\n    /></fieldset>;\r\n  }\r\n  render()\r\n  {\r\n    return <form className=\"controls\">\r\n        {this.renderHuButton()}\r\n        {this.renderStatus()}\r\n        {this.renderStartButton()}\r\n        {this.renderHandLength()}\r\n        {this.renderTileStyle()}\r\n        {this.renderTileSuit()}\r\n        {this.renderAllowPairs()}\r\n        {this.renderTimeBeforeDraw()}\r\n        {this.renderTimeBeforeSort()}\r\n        {this.renderTimeOfGame()}\r\n    </form>;\r\n  }\r\n}\r\ntype RadiosProps =\r\n{\r\n  choices: Array<any>,\r\n  name: string,\r\n  onChange: Handler,\r\n  defaultValue: any,\r\n};\r\nclass Radios extends React.Component<RadiosProps>\r\n{\r\n  render()\r\n  {\r\n    return <>{this.props.choices.map((v, i) => <Radio\r\n        key={i}\r\n        name={this.props.name}\r\n        value={v.value}\r\n        display={v.display}\r\n        onChange={this.props.onChange}\r\n        defaultValue={this.props.defaultValue}\r\n    />)}</>;\r\n  }\r\n}\r\ntype RadioProps =\r\n{\r\n  name: string,\r\n  value: string,\r\n  onChange: Handler,\r\n  defaultValue: string,\r\n  display: string,\r\n};\r\nclass Radio extends React.Component<RadioProps>\r\n{\r\n  render()\r\n  {\r\n    return <><input type=\"radio\" name={this.props.name}\r\n        id={`${this.props.name}-${this.props.value}`}\r\n        value={this.props.value}\r\n        onChange={this.props.onChange}\r\n        defaultChecked={this.props.value===this.props.defaultValue} />\r\n      <label htmlFor={`${this.props.name}-${this.props.value}`}>\r\n        {this.props.display}\r\n      </label></>;\r\n  }\r\n}\r\ntype RangeProps =\r\n{\r\n  id: string,\r\n  label: string,\r\n  value: {\r\n    min: number,\r\n    max: number,\r\n    step: number,\r\n    default: number,\r\n    display:  string | JSX.Element,\r\n  },\r\n  handler: Handler,\r\n};\r\nclass Range extends React.Component<RangeProps>\r\n{\r\n  render()\r\n  {\r\n    const value = this.props.value;\r\n    const id = this.props.id;\r\n    return <>\r\n      <label htmlFor={id}>{this.props.label}</label>\r\n      <input type=\"range\" id={id} name={id}\r\n        min={value.min} max={value.max} step={value.step} defaultValue={value.default}\r\n        onChange={this.props.handler} />\r\n      <output htmlFor={id}>{value.display}</output>\r\n    </>;\r\n  }\r\n}\r\nclass StartButton extends React.Component<{onClick: ()=>void}>\r\n{\r\n  render()\r\n  {\r\n    return <div className=\"start-button\" onClick={this.props.onClick}><span className=\"start-text\">start</span></div>;\r\n  }\r\n}\r\nclass HuButton extends React.Component<{onClick: ()=>void}>\r\n{\r\n  render()\r\n  {\r\n    return <div className=\"hu-button\" onClick={this.props.onClick}><span className=\"hu-text\">Hu</span></div>;\r\n  }\r\n}\r\n\r\nfunction formatDigits(n: number, d: number)\r\n{\r\n  const s = n.toString();\r\n  const l = s.length;\r\n  return <><span className=\"transparent\">{\"0\".repeat(d-l)}</span>{n}</>;\r\n}\r\n","import { createLogic as _createLogic, Logic, StandardAction } from 'redux-logic';\r\nimport { ActionCreator, isType } from 'typescript-fsa';\r\nimport { Dispatch, Done } from 'redux-logic-helper';\r\n\r\ntype Type = string;\r\ntype Object = object | undefined;\r\nexport function createLogic<\r\n  State extends object,\r\n  Payload extends Object = undefined,\r\n  Meta extends Object = undefined,\r\n  Dependency extends object = {},\r\n  Context extends Object = undefined,\r\n  Action extends StandardAction<Type, Payload, Meta> = StandardAction<Type, Payload, Meta>,\r\n>(actionCreator: ActionCreator<Payload>, config: {process: any, latest? : boolean, warnTimeout? : number}):\r\nLogic<State, any, any, Dependency, Context, Type>\r\n{\r\n  return _createLogic<State, any, any, Dependency, Context, Type, Action>({\r\n    ...config,\r\n    type: actionCreator.type,\r\n    process({ action, getState }: { action: any, getState?: () => State }, dispatch: Dispatch, done: Done){\r\n      if (!isType(action, actionCreator)) throw new TypeError();\r\n      config.process({action, getState}, dispatch, done);\r\n    },\r\n    validate: undefined,\r\n    transform: undefined,\r\n  });\r\n}\r\n","import { createLogicMiddleware } from 'redux-logic';\r\nimport { createLogic } from './redux-logic-helper';\r\nimport { Dispatch, Done, ActionOf, PayloadOf } from 'redux-logic-helper';\r\nimport { applyMiddleware, createStore, AnyAction } from 'redux';\r\nimport { actionCreatorFactory } from 'typescript-fsa';\r\nimport { reducerWithInitialState } from 'typescript-fsa-reducers';\r\nimport { fromTiles, Validator } from './hu';\r\nimport { Deal, nullDeal, discardTile, drawTile, dealHand, sortHand } from './deal';\r\nimport { Messages, appendMessage } from './gamecommon';\r\nconst actionCreator = actionCreatorFactory();\r\n\r\ntype GameState = {\r\n  deal: Deal,\r\n  score: number,\r\n  started: Date | null,\r\n  messages: Messages,\r\n};\r\nconst nullGame: GameState = {\r\n  deal: nullDeal,\r\n  score: 0,\r\n  started: null,\r\n  messages: [],\r\n};\r\n\r\nexport const gameActions = {\r\n  appendMessage: actionCreator<{message: string}>('appendMessage'),\r\n  discard: actionCreator<{position: number}>('discard'),\r\n  draw: actionCreator<{}>('draw'),\r\n  discardAndDraw: actionCreator<{position: number, timeBeforeDraw: number, timeBeforeSort: number}>('discardAndDraw'),\r\n  declareHu: actionCreator<{next: Deal, validator: Validator, timeBeforeDraw: number, timeBeforeSort: number}>('declareHu'),\r\n  reset: actionCreator<{deal: Deal}>('reset'),\r\n  resetAndDraw: actionCreator<{deal: Deal, timeBeforeDraw: number, timeBeforeSort: number}>('resetAndDraw'),\r\n  resetGame: actionCreator<({first: Deal, timeBeforeDraw: number, timeBeforeSort: number, timeOfGame: number})>('resetGame'),\r\n  newGame: actionCreator<({started: Date})>('newGame'),\r\n  sort: actionCreator<{}>('sort'),\r\n  sortAndDraw: actionCreator<{timeBetweenSortDraw: number}>('sortAndDraw'),\r\n  scoreHu: actionCreator<{time: Date, tbd: number}>('scoreHu'),\r\n  scoreCuohu: actionCreator<{}>('scoreCuohu'),\r\n  finish: actionCreator<{}>('finish'),\r\n}\r\n\r\nconst gameReducer = reducerWithInitialState(nullGame)\r\n.case(gameActions.discard, (state, payload) => ({...state,\r\n  deal: discardTile(state.deal, payload.position),\r\n}))\r\n.case(gameActions.draw, (state, _) => ({...state,\r\n  deal: drawTile(state.deal),\r\n}))\r\n.case(gameActions.reset, (state, payload) => ({...state,\r\n  deal: dealHand(payload.deal),\r\n}))\r\n.case(gameActions.sort, (state, _) => ({...state,\r\n  deal: sortHand(state.deal),\r\n}))\r\n.case(gameActions.newGame, (_, payload) => ({...nullGame,\r\n  started: payload.started,\r\n  messages: appendMessage([], `new game started at ${payload.started}`),\r\n}))\r\n.case(gameActions.appendMessage, (state, payload) => ({...state,\r\n  messages: appendMessage(state.messages, payload.message)\r\n}))\r\n.case(gameActions.scoreHu, (state, payload) => ({...state,\r\n  score: state.score + Math.sqrt(payload.tbd / (payload.time.valueOf() - state.deal.started!.valueOf())),\r\n}))\r\n.case(gameActions.scoreCuohu, (state, _) => ({...state,\r\n  score: state.score - 1,\r\n}))\r\n.case(gameActions.finish, (state, payload) => {\r\n  console.log(`finish at: ${new Date()}`);\r\n  console.log(state);\r\n  console.log(payload);\r\n  return {...nullGame,\r\n  messages: appendMessage([], `finish! score: ${~~(state.score * 1000)}`),\r\n};})\r\n;\r\n\r\nfunction dispatchWaitDispatch(firstAction: AnyAction, waitTimeMs: number, secondAction: AnyAction, dispatch: Dispatch, done: Done)\r\n{\r\n  dispatch(firstAction);\r\n  setTimeout(() => {\r\n    dispatch(secondAction);\r\n    done();\r\n  }, waitTimeMs);\r\n}\r\n\r\nfunction dispatchSequence(actions: AnyAction[], dispatch: Dispatch, done: Done)\r\n{\r\n  actions.forEach(action => {\r\n    dispatch(action);\r\n  });\r\n  done();\r\n}\r\n\r\nconst discardAndDrawLogic = createLogic<GameState, PayloadOf<typeof gameActions.discardAndDraw>>(\r\n  gameActions.discardAndDraw,\r\n  {\r\n    process({ action }: { action: ActionOf<typeof gameActions.discardAndDraw>}, dispatch: Dispatch, done: Done)\r\n    {\r\n      const [waitTimeMs, nextAction] = (action.payload.timeBeforeSort <= action.payload.timeBeforeDraw)\r\n        ? [action.payload.timeBeforeSort, gameActions.sortAndDraw({timeBetweenSortDraw: action.payload.timeBeforeDraw - action.payload.timeBeforeSort})]\r\n        : [action.payload.timeBeforeDraw, gameActions.draw({})];\r\n      dispatchWaitDispatch(\r\n        gameActions.discard({position: action.payload.position}),\r\n        waitTimeMs, nextAction,\r\n        dispatch, done);\r\n    }\r\n  });\r\nconst resetAndDrawLogic = createLogic(\r\n  gameActions.resetAndDraw,\r\n  {\r\n    process({ action }: { action: ActionOf<typeof gameActions.resetAndDraw> }, dispatch: Dispatch, done: Done)\r\n    {\r\n      console.log(action);\r\n      const [waitTimeMs, nextAction] = (action.payload.timeBeforeSort <= action.payload.timeBeforeDraw)\r\n        ? [action.payload.timeBeforeSort, gameActions.sortAndDraw({timeBetweenSortDraw: action.payload.timeBeforeDraw - action.payload.timeBeforeSort})]\r\n        : [action.payload.timeBeforeDraw, gameActions.draw({})];\r\n      dispatchWaitDispatch(\r\n        gameActions.reset({deal: action.payload.deal}),\r\n        waitTimeMs, nextAction,\r\n        dispatch, done);\r\n    }\r\n  });\r\nconst sortAndDrawLogic = createLogic(\r\n  gameActions.sortAndDraw,\r\n  {\r\n    process({ action }: { action: ActionOf<typeof gameActions.sortAndDraw> }, dispatch: Dispatch, done: Done)\r\n    {\r\n      dispatchWaitDispatch(\r\n        gameActions.sort({}),\r\n        action.payload.timeBetweenSortDraw,\r\n        gameActions.draw({}),\r\n        dispatch, done);\r\n    }\r\n  });\r\nconst resetGamelogic = createLogic(\r\n  gameActions.resetGame,\r\n  {\r\n    latest: true,\r\n    warnTimeout: 0,\r\n    process({ action }: { action: ActionOf<typeof gameActions.resetGame> }, dispatch: Dispatch, done: Done)\r\n    {\r\n      console.log(action.payload);\r\n      dispatch(gameActions.newGame({started: action.payload.first.started!}));\r\n      dispatchWaitDispatch(\r\n        gameActions.resetAndDraw({\r\n          deal: action.payload.first,\r\n          timeBeforeDraw: action.payload.timeBeforeDraw,\r\n          timeBeforeSort: action.payload.timeBeforeSort,\r\n        }),\r\n        action.payload.timeOfGame,\r\n        gameActions.finish({}),\r\n        dispatch, done);\r\n      console.log(`${new Date()}`);\r\n    }\r\n  });\r\nconst declareHuLogic = createLogic(\r\n  gameActions.declareHu,\r\n  {\r\n    process({ action, getState }: { action: ActionOf<typeof gameActions.declareHu>, getState: () => GameState }, dispatch: Dispatch, done: Done)\r\n    {\r\n      const hu = action.payload.validator(fromTiles(getState().deal.hand));\r\n      const firstAction = hu\r\n        ? gameActions.scoreHu({time: action.payload.next.started!, tbd: action.payload.timeBeforeDraw})\r\n        : gameActions.scoreCuohu({});\r\n      dispatchSequence([\r\n        firstAction,\r\n        gameActions.appendMessage({message: `declared ${hu} hu`}),\r\n        gameActions.resetAndDraw({\r\n          deal: action.payload.next,\r\n          timeBeforeDraw: action.payload.timeBeforeDraw,\r\n          timeBeforeSort: action.payload.timeBeforeSort,\r\n        })], dispatch, done);\r\n    }\r\n  });\r\nconst logics = [\r\n  discardAndDrawLogic,\r\n  resetAndDrawLogic,\r\n  resetGamelogic,\r\n  sortAndDrawLogic,\r\n  declareHuLogic];\r\nexport const gameStore = createStore(gameReducer, applyMiddleware(createLogicMiddleware(logics)));\r\n","import React from 'react';\nimport { connect, Provider } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport { Game } from './components';\nimport { gameActions, gameStore } from './gamelogics';\nimport { shufflePile } from './gamecommon';\nimport './App.css';\n\nconst ConnectedGame = connect(\n    (storeState) => (storeState),\n    (dispatch) => ({actions: bindActionCreators(gameActions, dispatch)}),\n)(Game);\n\nfunction App() {\n  return (\n    <Provider store={gameStore}>\n      <ConnectedGame initializer={shufflePile} />\n    </Provider>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}