{"version":3,"sources":["gamecommon.ts","common.ts","hu.ts","deal.ts","components.tsx","redux-logic-helper.ts","gamelogics.ts","App.js","serviceWorker.js","index.js"],"names":["rank","tile","shufflePile","m","ranks","pile","Array","from","keys","i","Math","floor","random","appendMessage","messages","newMessage","length","slice","range","n","isNormalHu","hand","entries","handCopied","isSets","gamecommon","c","isPairs","sets","pairs","drawTile","deal","push","p","dealHand","sortHand","console","log","sort","a","b","ret","newDeal","shuffle","date","started","huValidator","allowPairs","count","isPairsWithHog","tileClass","theme","tileStyle","tileSuit","PostModernBamboos","PostModernCharacters","PostModernDots","GLMahjongTileBamboos","GLMahjongTileCharacters","GLMahjongTileDots","tileHeight","Game","props","handleWindowResize","window","innerWidth","setState","windowInnerWidth","handleTimeRestChanged","game","kind","timeRest","valueOf","state","settings","timeOfGame","Date","handleHandLengthChanged","e","handLength","parseInt","target","value","handleTileStyleChanged","handleTileSuitChanged","handleAllowPairsChanged","handleTimeBeforeDrawChanged","timeBeforeDraw","handleTimeBeforeSortChanged","timeBeforeSort","handleTimeOfGameChanged","declareHu","actions","validator","next","initializer","directDiscardAndDraw","TypeError","discardAndDraw","position","resetGame","first","nullGame","handleKeydown","keyCode","preventDefault","findIndex","index","displayTime","document","addEventListener","this","setInterval","removeEventListener","clearInterval","maxTiles","discard","width","score","time","hu","reset","handler","close","isOpen","React","Component","Hand","key","onClick","scale","height","map","renderTile","HandOuter","className","style","children","HandInner","transformOrigin","transform","Tile","src","imageUrl","generateStyle","alt","toString","r","PostModernTile","clip","top","right","bottom","left","GLMahjongTile","suit","Status","v","Controls","toFixed","choices","display","formatDigits","name","defaultValue","onChange","id","label","min","max","step","default","renderHuButton","renderStatus","renderStartButton","renderHandLength","renderTileStyle","renderTileSuit","renderAllowPairs","renderTimeBeforeDraw","renderTimeBeforeSort","renderTimeOfGame","Radios","Radio","type","defaultChecked","htmlFor","Range","StartButton","HuButton","ResultDialog","encodeURIComponent","shouldCloseOnOverlayClick","overlayClassName","href","renderText","d","l","repeat","createLogic","actionCreator","config","_createLogic","process","dispatch","done","action","getState","isType","validate","undefined","actionCreatorFactory","transitionPlaying","f","gameActions","draw","dealAndDraw","newGame","newGameAndDraw","sortAndDraw","scoreHu","scoreCuohu","finish","gameReducer","reducerWithInitialState","case","payload","splice","discardTile","_","message","sqrt","tbd","dispatchWaitDispatch","firstAction","waitTimeMs","secondAction","setTimeout","discardAndDrawLogic","timeBetweenSortDraw","nextAction","dealAndDrawLogic","sortAndDrawLogic","newGameAndDrawLogic","logics","latest","warnTimeout","fill","forEach","fromTiles","dispatchSequence","gameStore","createStore","applyMiddleware","createLogicMiddleware","ConnectedGame","connect","storeState","bindActionCreators","App","store","Boolean","location","hostname","match","ReactDOM","render","StrictMode","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","error"],"mappings":"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","file":"static/js/main.c8e140e1.chunk.js","sourcesContent":["export type Hand = Array<number>;\r\nexport type Pile = Array<number>;\r\nexport type Tile = number;\r\nexport const ranks = 9;\r\nexport const duplicates = 4;\r\nexport const deck = ranks * duplicates;\r\nexport function rank(tile: Tile): number\r\n{\r\n    return ~~(tile/duplicates);\r\n}\r\nexport function shufflePile(): Pile\r\n{\r\n  let m = deck;\r\n  let pile = Array.from(Array(m).keys());\r\n  while (m)\r\n  {\r\n    const i = Math.floor(Math.random() * (m--));\r\n    [pile[i], pile[m]] = [pile[m], pile[i]];\r\n  }\r\n  return pile;\r\n}\r\nexport const setSize = 3;\r\nexport const pairSize = 2;\r\nexport type Message = [number, string];\r\nexport type Messages = Array<Message>;\r\nexport function appendMessage(messages: Messages, newMessage: string): Messages\r\n{\r\n  if (messages.length === 0) return [[0, newMessage]];\r\n  const ret: Messages = [...messages, [messages[messages.length-1][0]+1, newMessage]];\r\n  return ret.slice(-4);\r\n}\r\n","export function* range(n: number)\r\n{\r\n  for (let i = 0; i < n; i++) yield i;\r\n}\r\n","import * as gamecommon from './gamecommon';\r\nimport { range } from './common';\r\n\r\nexport function fromTiles(hand: gamecommon.Hand): Array<number>\r\n{\r\n  let ret = new Array(gamecommon.ranks).fill(0);\r\n  hand.forEach(tile => {ret[gamecommon.rank(tile)] += 1});\r\n  return ret;\r\n}\r\n\r\nexport type Validator = (hand: Array<number>) => boolean;\r\n\r\nexport function isNormalHu(hand: Array<number>): boolean\r\n{\r\n  for (const [rank, count] of hand.entries())\r\n  {\r\n    if (count < gamecommon.pairSize)\r\n    continue;\r\n    let handCopied = [...hand];\r\n    handCopied[rank] -= gamecommon.pairSize;\r\n    if (isSets(handCopied)) return true;\r\n  }\r\n  return false;\r\n}\r\n\r\nexport function isSets(hand: Array<number>): boolean\r\n{\r\n  for (const rank of range(gamecommon.ranks - gamecommon.setSize + 1))\r\n  {\r\n    if (hand[rank] < 0) return false;\r\n    hand[rank] %= gamecommon.setSize;\r\n    const c = hand[rank];\r\n    for (const d of range(gamecommon.setSize))\r\n    {\r\n      hand[rank + d] -= c;\r\n    }\r\n  }\r\n  for (const count of hand)\r\n  {\r\n    if (count % gamecommon.setSize) return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nexport function isPairs(hand: Array<number>): boolean\r\n{\r\n  let sets = 0;\r\n  let pairs = 0;\r\n  for (const count of hand)\r\n  {\r\n    switch (count)\r\n    {\r\n      case 0: continue;\r\n      case gamecommon.setSize: sets += 1; continue;\r\n      case gamecommon.pairSize: pairs += 1; continue;\r\n      default: return false;\r\n    }\r\n  }\r\n  return (sets <= 1) && (pairs % gamecommon.setSize === 1);\r\n}\r\n\r\nexport function isPairsWithHog(hand: Array<number>): boolean\r\n{\r\n  let sets = 0;\r\n  let pairs = 0;\r\n  for (const count of hand)\r\n  {\r\n    if (count === gamecommon.setSize)\r\n    {\r\n      sets += 1;\r\n      continue;\r\n    }\r\n    if (count % gamecommon.pairSize)\r\n      return false;\r\n    pairs += count / gamecommon.pairSize;\r\n  }\r\n  return (sets <= 1) && (pairs % gamecommon.setSize === 1);\r\n}\r\n","import { Hand, Pile } from './gamecommon';\r\nexport type Deal =\r\n{\r\n  hand: Hand,\r\n  p: number,\r\n  pile: Pile,\r\n  started: Date,\r\n};\r\nexport function discardTile(deal: Deal, position: number)\r\n{\r\n  let hand = [...deal.hand];\r\n  hand.splice(position, 1);\r\n  return {...deal,\r\n    hand,\r\n  };\r\n}\r\nexport function drawTile(deal: Deal)\r\n{\r\n  let hand = [...deal.hand];\r\n  hand.push(deal.pile[deal.p]);\r\n  return {...deal,\r\n    hand,\r\n    p: deal.p+1,\r\n  };\r\n}\r\nexport function dealHand(deal: Deal): Deal\r\n{\r\n  return {...deal,\r\n    hand: deal.pile.slice(0, deal.p),\r\n  };\r\n}\r\nexport function sortHand(deal: Deal): Deal\r\n{\r\n  console.log(deal);\r\n  let hand = [...deal.hand];\r\n  hand.sort((a, b) => (a - b));\r\n  const ret = {...deal,\r\n    hand,\r\n  };\r\n  console.log(ret);\r\n  return ret;\r\n}\r\nexport function newDeal(shuffle: () => Pile, date: () => Date, p: number): Deal\r\n{\r\n  const pile = shuffle();\r\n  const started = date();\r\n  return dealHand({\r\n    hand: [],\r\n    p,\r\n    pile,\r\n    started,\r\n  });\r\n}\r\n","import React from 'react';\r\nimport Modal from 'react-modal';\r\nimport * as gamecommon from './gamecommon';\r\nimport { GameState } from './gamelogics';\r\nimport { isNormalHu, isPairs, isPairsWithHog, Validator } from './hu';\r\nimport { gameActions } from './gamelogics';\r\nimport { newDeal } from './deal';\r\n\r\ntype AllowPairs = \"disallow\" | \"allow\" | \"allow-hog\";\r\ntype TileStyle = \"PostModern\" | \"GLMahjongTile\";\r\ntype TileSuit = \"bamboos\" | \"characters\" | \"dots\";\r\n\r\ntype GameProps =\r\n{\r\n  initializer: ()=>Array<number>,\r\n  actions: typeof gameActions,\r\n} & GameState;\r\ntype Settings =\r\n{\r\n  handLength: number,\r\n  allowPairs: AllowPairs,\r\n  timeBeforeDraw: number,\r\n  timeBeforeSort: number,\r\n  timeOfGame: number,\r\n};\r\nfunction toString(settings: Settings): string\r\n{\r\n  return `${settings.handLength}${(\r\n    settings.allowPairs === 'disallow' ? '' :\r\n    settings.allowPairs === 'allow' ? 'p' : 'pp'\r\n  )} ${settings.timeOfGame/1000}/${settings.timeBeforeDraw/1000}` + (\r\n    settings.timeBeforeSort < settings.timeBeforeDraw ? `(${settings.timeBeforeSort/1000})` : ''\r\n  );\r\n}\r\nfunction huValidator(allowPairs: AllowPairs): Validator\r\n{\r\n  switch (allowPairs)\r\n  {\r\n    case 'disallow': return isNormalHu;\r\n    case 'allow': return (hand) => isNormalHu(hand) || isPairs(hand);\r\n    case 'allow-hog': return (hand) => isNormalHu(hand) || isPairs(hand) || isPairsWithHog(hand);\r\n  }\r\n}\r\ntype Theme =\r\n{\r\n  tileStyle: TileStyle,\r\n  tileSuit: TileSuit,\r\n}\r\nfunction tileClass(theme: Theme): React.ComponentClass<TileProps>\r\n{\r\n  switch (theme.tileStyle)\r\n  {\r\n    case 'PostModern': switch (theme.tileSuit)\r\n    {\r\n      case 'bamboos': return PostModernBamboos;\r\n      case 'characters': return PostModernCharacters;\r\n      case 'dots': return PostModernDots;\r\n    }\r\n    case 'GLMahjongTile': switch (theme.tileSuit)\r\n    {\r\n      case 'bamboos': return GLMahjongTileBamboos;\r\n      case 'characters': return GLMahjongTileCharacters;\r\n      case 'dots': return GLMahjongTileDots;\r\n    }\r\n  }\r\n}\r\nfunction tileHeight(theme: Theme): number\r\n{\r\n  switch (theme.tileStyle)\r\n  {\r\n    case 'PostModern': return 88;\r\n    case 'GLMahjongTile': return 91;\r\n  }\r\n}\r\ntype GameComponentState =\r\n{\r\n  settings: Settings,\r\n  theme: Theme,\r\n  timeRest: number | null,\r\n  displayTime: NodeJS.Timeout | null,\r\n  windowInnerWidth: number,\r\n};\r\n\r\nexport class Game extends React.Component<GameProps, GameComponentState>\r\n{\r\n  constructor (props: GameProps)\r\n  {\r\n    super (props);\r\n    this.state = {\r\n      settings: {\r\n        handLength: 13,\r\n        allowPairs: \"allow\",\r\n        timeBeforeDraw: 1000,\r\n        timeBeforeSort: 500,\r\n        timeOfGame: 60000,\r\n      },\r\n      theme: {\r\n        tileStyle: \"PostModern\",\r\n        tileSuit: \"dots\",\r\n      },\r\n      timeRest: null,\r\n      displayTime: null,\r\n      windowInnerWidth: window.innerWidth,\r\n    };\r\n  }\r\n  handleWindowResize = () => {\r\n    console.log(`windowInnerWidth: ${window.innerWidth}`);\r\n    this.setState({windowInnerWidth: window.innerWidth});\r\n  }\r\n  handleTimeRestChanged = () => {\r\n    if (this.props.game.kind !== 'playing')\r\n      return;\r\n    let timeRest = this.props.game.started.valueOf() + this.state.settings.timeOfGame - new Date().valueOf();\r\n    if (timeRest < 0)\r\n      timeRest = 0;\r\n    this.setState({timeRest});\r\n  };\r\n  handleHandLengthChanged = (e: React.ChangeEvent<HTMLInputElement>) =>\r\n  {\r\n    this.setState({settings: {...this.state.settings, handLength: parseInt(e.target.value)}});\r\n  };\r\n  handleTileStyleChanged = (e: React.ChangeEvent<HTMLInputElement>) =>\r\n  {\r\n    this.setState({theme: {...this.state.theme, tileStyle: e.target.value as TileStyle}});\r\n  };\r\n  handleTileSuitChanged = (e: React.ChangeEvent<HTMLInputElement>) =>\r\n  {\r\n    this.setState({theme: {...this.state.theme, tileSuit: e.target.value as TileSuit}});\r\n  };\r\n  handleAllowPairsChanged = (e: React.ChangeEvent<HTMLInputElement>) =>\r\n  {\r\n    this.setState({settings: {...this.state.settings, allowPairs: e.target.value as AllowPairs}});\r\n  }\r\n  handleTimeBeforeDrawChanged = (e: React.ChangeEvent<HTMLInputElement>) =>\r\n  {\r\n    this.setState({settings: {...this.state.settings, timeBeforeDraw: parseInt(e.target.value)}});\r\n  };\r\n  handleTimeBeforeSortChanged = (e: React.ChangeEvent<HTMLInputElement>) =>\r\n  {\r\n    this.setState({settings: {...this.state.settings, timeBeforeSort: parseInt(e.target.value)}});\r\n  };\r\n  handleTimeOfGameChanged = (e: React.ChangeEvent<HTMLInputElement>) =>\r\n  {\r\n    this.setState({settings: {...this.state.settings, timeOfGame: parseInt(e.target.value)}});\r\n  };\r\n/*  handleOpenModal = () =>\r\n  {\r\n    this.setState({openModal: true});\r\n  }\r\n  handleCloseModal = () =>\r\n  {\r\n    this.setState({openModal: false});\r\n  }*/\r\n  declareHu = () =>\r\n  {\r\n    return this.props.actions.declareHu({\r\n      validator: huValidator(this.state.settings.allowPairs),\r\n      next: newDeal(this.props.initializer, (() => new Date()), this.state.settings.handLength),\r\n      timeBeforeDraw: this.state.settings.timeBeforeDraw,\r\n      timeBeforeSort: this.state.settings.timeBeforeSort,\r\n    });\r\n  };\r\n  directDiscardAndDraw = () =>\r\n  {\r\n    if (this.props.game.kind !== 'playing') throw new TypeError();\r\n    return this.discardAndDraw(this.props.game.deal.hand.length - 1);\r\n  };\r\n  discardAndDraw = (position: number) =>\r\n  {\r\n    return this.props.actions.discardAndDraw({\r\n      position: position,\r\n      timeBeforeDraw: this.state.settings.timeBeforeDraw,\r\n      timeBeforeSort: this.state.settings.timeBeforeSort});\r\n  };\r\n  resetGame = () =>\r\n  {\r\n    return this.props.actions.resetGame({\r\n      first: newDeal(this.props.initializer, (() => new Date()), this.state.settings.handLength),\r\n      timeBeforeDraw: this.state.settings.timeBeforeDraw,\r\n      timeBeforeSort: this.state.settings.timeBeforeSort,\r\n      timeOfGame: this.state.settings.timeOfGame,\r\n    });\r\n  };\r\n  nullGame = () =>\r\n  {\r\n    return this.props.actions.nullGame({});\r\n  }\r\n  handleKeydown = (e: KeyboardEvent) =>\r\n  {\r\n    if (e.keyCode === 32) // space: hu\r\n    {\r\n      e.preventDefault();\r\n      return this.declareHu();\r\n    }\r\n    if (e.keyCode < 48) return;\r\n    if (e.keyCode === 48) // 0: drawn\r\n    {\r\n      return this.directDiscardAndDraw();\r\n    }\r\n    if (e.keyCode === 83) // s: start\r\n    {\r\n      return this.resetGame();\r\n    }\r\n    if (58 <= e.keyCode) return;\r\n    if (this.props.game.kind !== 'playing') throw new TypeError();\r\n    console.log(`keyCode: ${e.keyCode}`);\r\n    let rank = e.keyCode - 49;\r\n    console.log(`rank: ${rank}`);\r\n    let position = this.props.game.deal.hand.findIndex((tile, index) => {\r\n      console.log(`${index}: ${tile}`);\r\n      return (gamecommon.rank(tile) === rank);\r\n    });\r\n    console.log(`position: ${position}`);\r\n    if (0 <= position)\r\n      return this.discardAndDraw(position);\r\n  };\r\n  componentDidMount()\r\n  {\r\n    document.addEventListener(\"keydown\", this.handleKeydown);\r\n    this.setState({displayTime: setInterval(this.handleTimeRestChanged, 10)});\r\n    window.addEventListener('resize', this.handleWindowResize);\r\n  }\r\n  componentWillUnmount()\r\n  {\r\n    document.removeEventListener(\"keydown\", this.handleKeydown);\r\n    clearInterval(this.state.displayTime!);\r\n    window.removeEventListener('resize', this.handleWindowResize);\r\n  }\r\n  render()\r\n  {\r\n    console.log(this.props);\r\n    console.log(this.state);\r\n    return <>\r\n        <Hand theme={this.state.theme} hand={\r\n            this.props.game.kind === 'playing'\r\n            ? this.props.game.deal.hand\r\n            : []}\r\n          tileClass={tileClass(this.state.theme)}\r\n          maxTiles={this.state.settings.handLength+1}\r\n          discard={this.discardAndDraw}\r\n          width={this.state.windowInnerWidth} />\r\n        <Controls\r\n          score={\r\n            this.props.game.kind === 'null'\r\n            ? null\r\n            : this.props.game.score}\r\n          time={this.state.timeRest}\r\n          hu={this.declareHu}\r\n          reset={this.resetGame}\r\n          handLength={{handler: this.handleHandLengthChanged}}\r\n          tileStyle={{handler: this.handleTileStyleChanged}}\r\n          tileSuit={{handler: this.handleTileSuitChanged}}\r\n          allowPairs={{handler: this.handleAllowPairsChanged}}\r\n          timeBeforeDraw={{handler: this.handleTimeBeforeDrawChanged, value: this.state.settings.timeBeforeDraw}}\r\n          timeBeforeSort={{handler: this.handleTimeBeforeSortChanged, value: this.state.settings.timeBeforeSort}}\r\n          timeOfGame={{handler: this.handleTimeOfGameChanged, value: this.state.settings.timeOfGame}}\r\n        />\r\n        <Status messages={this.props.messages} />\r\n        <ResultDialog\r\n          close={this.nullGame}\r\n          isOpen={this.props.game.kind === 'finished'}\r\n          score={~~((this.props.game.kind === 'null'\r\n            ? 0\r\n            : this.props.game.score) * 1000)}\r\n          settings={toString(this.state.settings)}\r\n        ></ResultDialog>\r\n    </>;\r\n  }\r\n}\r\n\r\ntype HandProps =\r\n{\r\n  hand: gamecommon.Hand,\r\n  maxTiles: number,\r\n  theme: Theme,\r\n  tileClass: React.ComponentClass<TileProps>,\r\n  discard: (position: number) => void,\r\n  width: number,\r\n};\r\nclass Hand extends React.Component<HandProps>\r\n{\r\n  renderTile(i: number, tile: gamecommon.Tile)\r\n  {\r\n    return (<this.props.tileClass key={tile} rank={gamecommon.rank(tile)} onClick={()=>this.props.discard(i)}/>);\r\n  }\r\n  render()\r\n  {\r\n    console.log(this.state);\r\n    return <HandOuter scale={this.props.width / (64 * this.props.maxTiles)} height={tileHeight(this.props.theme)}>\r\n      <HandInner width={64*this.props.maxTiles} scale={this.props.width / (64 * this.props.maxTiles)}>\r\n        {this.props.hand.map((tile, i)=>this.renderTile(i, tile))}\r\n        </HandInner></HandOuter>;\r\n  }\r\n}\r\n\r\nclass HandOuter extends React.Component<{scale: number, height: number}>\r\n{\r\n  render()\r\n  {\r\n    return <div className=\"hand-container\" style={{\r\n      height: `${this.props.scale * this.props.height}px`\r\n    }}>{this.props.children}</div>;\r\n  }\r\n}\r\nclass HandInner extends React.Component<{width: number, scale: number}>\r\n{\r\n  render()\r\n  {\r\n    return <div className=\"hand\" style={{\r\n      width: `${this.props.width}px`,\r\n      transformOrigin: 'top left',\r\n      transform: `scale(${this.props.scale})`,\r\n    }}>{this.props.children}</div>;\r\n  }\r\n}\r\n\r\ntype TileProps =\r\n{\r\n  rank: number,\r\n  onClick: () => void,\r\n};\r\n\r\nclass Tile extends React.Component<TileProps>\r\n{\r\n  render()\r\n  {\r\n    return <div className={`tile ${this.tileClass()}`} onClick={this.props.onClick}>\r\n      <img src={this.imageUrl()}\r\n      style={this.generateStyle(this.props.rank)}\r\n      alt={(this.props.rank+1).toString()}/></div>\r\n  }\r\n  tileClass(): string\r\n  {\r\n    throw new TypeError(\"tileClass() is not implemented\");\r\n  }\r\n  imageUrl(): string\r\n  {\r\n    throw new TypeError(\"imageUrl() is not implemented\");\r\n  }\r\n  generateStyle(r: number): any{throw new TypeError(\"\");}\r\n}\r\n\r\nclass PostModernTile extends Tile\r\n{\r\n  generateStyle(r: number)\r\n  {\r\n    return {\r\n        clip: `rect(${this.top(r)}, ${this.right(r)}, ${this.bottom(r)}, ${this.left(r)})`,\r\n        top: -this.top(r),\r\n        left: -this.left(r),\r\n    };\r\n  }\r\n  tileClass()\r\n  {\r\n    return 'pm';\r\n  }\r\n  right(r: number): number{throw new TypeError(\"right() is not implemented\");}\r\n  left(r: number): number{throw new TypeError(\"left() is not implemented\");}\r\n  top(r: number){return 0;}\r\n  bottom(r: number){return 88;}\r\n  imageUrl()\r\n  {\r\n    return \"postmodern.svg\";\r\n  }\r\n}\r\n\r\nclass PostModernBamboos extends PostModernTile\r\n{\r\n  left(r: number){return (24+r)*64;}\r\n  right(r: number){return (25+r)*64;}\r\n}\r\n\r\nclass PostModernCharacters extends PostModernTile\r\n{\r\n  left(r: number){return (15+r)*64;}\r\n  right(r: number){return (16+r)*64;}\r\n}\r\n\r\nclass PostModernDots extends PostModernTile\r\n{\r\n  left(r: number){return (0+r)*64;}\r\n  right(r: number){return (1+r)*64;}\r\n}\r\n\r\nclass GLMahjongTile extends Tile\r\n{\r\n  suit(): string{throw new TypeError(\"suit() is not implemented\");}\r\n  imageUrl()\r\n  {\r\n    return `gl-mahjongtile-svg/${this.suit()}-${this.props.rank}.svg`;\r\n  }\r\n  tileClass()\r\n  {\r\n    return 'gl';\r\n  }\r\n  generateStyle(r: number)\r\n  {\r\n    return {\r\n      transform: 'scale(1, -1)',\r\n    };\r\n  }\r\n}\r\n\r\nclass GLMahjongTileBamboos extends GLMahjongTile\r\n{\r\n  suit()\r\n  {\r\n    return 'b';\r\n  }\r\n}\r\n\r\nclass GLMahjongTileCharacters extends GLMahjongTile\r\n{\r\n  suit()\r\n  {\r\n    return 'c';\r\n  }\r\n}\r\n\r\nclass GLMahjongTileDots extends GLMahjongTile\r\n{\r\n  suit()\r\n  {\r\n    return 'd';\r\n  }\r\n}\r\n\r\ntype StatusProps =\r\n{\r\n  messages: Array<[number, string]>\r\n};\r\nclass Status extends React.Component<StatusProps>\r\n{\r\n  render()\r\n  {\r\n    return <ul className=\"status\">\r\n      {this.props.messages.map((v) => <li key={v[0]}>{v[1]}</li>)}\r\n    </ul>;\r\n  }\r\n}\r\n\r\ntype Handler = (e: React.ChangeEvent<HTMLInputElement>) => void;\r\ntype HasHandler =\r\n{\r\n  handler: Handler\r\n};\r\ntype HasHandlerAndValue =\r\n{\r\n  handler: Handler,\r\n  value: any,\r\n}\r\ntype ControlsProps =\r\n{\r\n  reset: () => void,\r\n  hu: () => void,\r\n  score: number | null,\r\n  time: number | null,\r\n  handLength: HasHandler,\r\n  tileStyle: HasHandler,\r\n  tileSuit: HasHandler,\r\n  allowPairs: HasHandler,\r\n  timeBeforeDraw: HasHandlerAndValue,\r\n  timeBeforeSort: HasHandlerAndValue,\r\n  timeOfGame: HasHandlerAndValue,\r\n};\r\n\r\nclass Controls extends React.Component<ControlsProps>\r\n{\r\n  renderHuButton()\r\n  {\r\n    return <HuButton onClick={this.props.hu} />;\r\n  }\r\n  renderStatus()\r\n  {\r\n    return <div className=\"status-labels\">\r\n      <div className=\"status-label\">{(this.props.score == null) ? `` : `score: ${~~(this.props.score * 1000)}`}</div>\r\n      <div className=\"status-label\">{(this.props.time == null) ? `` : `time: ${(this.props.time/1000).toFixed(2)}`}</div>\r\n    </div>;\r\n  }\r\n  renderStartButton()\r\n  {\r\n    return <StartButton onClick={this.props.reset} />;\r\n  }\r\n  renderHandLength()\r\n  {\r\n    return <fieldset className=\"hand-length\">\r\n        <span className=\"radio-label\">#tiles</span>\r\n        <Radios choices={[1, 4, 7, 10, 13, 16].map((v) =>\r\n          ({display: formatDigits(v, 2), value: v}))}\r\n          name=\"hand-length\"\r\n          defaultValue={13}\r\n          onChange={this.props.handLength.handler} />\r\n        </fieldset>;\r\n  }\r\n  renderTileStyle()\r\n  {\r\n    return <fieldset className=\"tile-style\">\r\n        <span className=\"radio-label\">tile style</span>\r\n        <Radios choices={[\r\n          {display: \"PostModern\", value: \"PostModern\"},\r\n          {display: \"GL-MT\", value: \"GLMahjongTile\"}]}\r\n          name=\"tile-style\"\r\n          defaultValue=\"PostModern\"\r\n          onChange={this.props.tileStyle.handler} />\r\n        </fieldset>;\r\n  }\r\n  renderTileSuit()\r\n  {\r\n    return <fieldset className=\"tile-suit\">\r\n        <span className=\"radio-label\">suit</span>\r\n        <Radios choices={[\r\n          {display: \"bams/索/条\", value: \"bamboos\"},\r\n          {display: \"chars/萬/万\", value: \"characters\"},\r\n          {display: \"dots/筒/饼\", value: \"dots\"}]}\r\n          name=\"tile-suit\"\r\n          defaultValue=\"dots\"\r\n          onChange={this.props.tileSuit.handler} />\r\n        </fieldset>;\r\n  }\r\n  renderAllowPairs()\r\n  {\r\n    return <fieldset className=\"allow-pairs\">\r\n        <span className=\"radio-label\">pairs</span>\r\n        <Radios choices={[\r\n          {display: \"disallow\", value: \"disallow\"},\r\n          {display: \"allow\", value: \"allow\"},\r\n          {display: \"tile hog\", value: \"allow-hog\"}]}\r\n          name=\"allow-pairs\"\r\n          defaultValue=\"allow\"\r\n          onChange={this.props.allowPairs.handler} />\r\n        </fieldset>;\r\n  }\r\n  renderTimeBeforeDraw()\r\n  {\r\n    return <fieldset><Range\r\n        id=\"time-before-draw\"\r\n        label=\"time before draw\"\r\n        handler={this.props.timeBeforeDraw.handler}\r\n        value={{\r\n          min: 100,\r\n          max: 9900,\r\n          step: 100,\r\n          default: 1000,\r\n          display: (this.props.timeBeforeDraw.value/1000).toFixed(1)+\"s\",\r\n        }} /></fieldset>;\r\n  }\r\n  renderTimeBeforeSort()\r\n  {\r\n    return <fieldset><Range\r\n        id=\"time-before-sort\"\r\n        label=\"time before sort\"\r\n        handler={this.props.timeBeforeSort.handler}\r\n        value={{\r\n          min: 0,\r\n          max: 9900,\r\n          step: 100,\r\n          default: 500,\r\n          display: (this.props.timeBeforeSort.value/1000).toFixed(1)+\"s\",\r\n        }} /></fieldset>\r\n  }\r\n  renderTimeOfGame()\r\n  {\r\n    return <fieldset><Range\r\n        id=\"time-of-game\"\r\n        label=\"time of game\"\r\n        handler={this.props.timeOfGame.handler}\r\n        value={{\r\n          min: 30000,\r\n          max: 600000,\r\n          step: 1000,\r\n          default: 60000,\r\n          display: <>{formatDigits(this.props.timeOfGame.value/1000, 3)}s</>,\r\n        }}\r\n    /></fieldset>;\r\n  }\r\n  render()\r\n  {\r\n    return <form className=\"controls\">\r\n        {this.renderHuButton()}\r\n        {this.renderStatus()}\r\n        {this.renderStartButton()}\r\n        {this.renderHandLength()}\r\n        {this.renderTileStyle()}\r\n        {this.renderTileSuit()}\r\n        {this.renderAllowPairs()}\r\n        {this.renderTimeBeforeDraw()}\r\n        {this.renderTimeBeforeSort()}\r\n        {this.renderTimeOfGame()}\r\n    </form>;\r\n  }\r\n}\r\ntype RadiosProps =\r\n{\r\n  choices: Array<any>,\r\n  name: string,\r\n  onChange: Handler,\r\n  defaultValue: any,\r\n};\r\nclass Radios extends React.Component<RadiosProps>\r\n{\r\n  render()\r\n  {\r\n    return <>{this.props.choices.map((v, i) => <Radio\r\n        key={i}\r\n        name={this.props.name}\r\n        value={v.value}\r\n        display={v.display}\r\n        onChange={this.props.onChange}\r\n        defaultValue={this.props.defaultValue}\r\n    />)}</>;\r\n  }\r\n}\r\ntype RadioProps =\r\n{\r\n  name: string,\r\n  value: string,\r\n  onChange: Handler,\r\n  defaultValue: string,\r\n  display: string,\r\n};\r\nclass Radio extends React.Component<RadioProps>\r\n{\r\n  render()\r\n  {\r\n    return <><input type=\"radio\" name={this.props.name}\r\n        id={`${this.props.name}-${this.props.value}`}\r\n        value={this.props.value}\r\n        onChange={this.props.onChange}\r\n        defaultChecked={this.props.value===this.props.defaultValue} />\r\n      <label htmlFor={`${this.props.name}-${this.props.value}`}>\r\n        {this.props.display}\r\n      </label></>;\r\n  }\r\n}\r\ntype RangeProps =\r\n{\r\n  id: string,\r\n  label: string,\r\n  value: {\r\n    min: number,\r\n    max: number,\r\n    step: number,\r\n    default: number,\r\n    display:  string | JSX.Element,\r\n  },\r\n  handler: Handler,\r\n};\r\nclass Range extends React.Component<RangeProps>\r\n{\r\n  render()\r\n  {\r\n    const value = this.props.value;\r\n    const id = this.props.id;\r\n    return <>\r\n      <label htmlFor={id}>{this.props.label}</label>\r\n      <input type=\"range\" id={id} name={id}\r\n        min={value.min} max={value.max} step={value.step} defaultValue={value.default}\r\n        onChange={this.props.handler} />\r\n      <output htmlFor={id}>{value.display}</output>\r\n    </>;\r\n  }\r\n}\r\nclass StartButton extends React.Component<{onClick: ()=>void}>\r\n{\r\n  render()\r\n  {\r\n    return <div className=\"start-button\" onClick={this.props.onClick}><span className=\"start-text\">start</span></div>;\r\n  }\r\n}\r\nclass HuButton extends React.Component<{onClick: ()=>void}>\r\n{\r\n  render()\r\n  {\r\n    return <div className=\"hu-button\" onClick={this.props.onClick}><span className=\"hu-text\">Hu</span></div>;\r\n  }\r\n}\r\ntype ResultDialogProps = {\r\n  close: () => void,\r\n  isOpen: boolean,\r\n  score: number,\r\n  settings: string,\r\n};\r\nclass ResultDialog extends React.Component<ResultDialogProps>\r\n{\r\n  renderText(): string\r\n  {\r\n    return encodeURIComponent(`Score: ${this.props.score} (settings: ${this.props.settings})`);\r\n  }\r\n  render()\r\n  {\r\n    return <Modal\r\n      isOpen={this.props.isOpen}\r\n      shouldCloseOnOverlayClick={true}\r\n      className='result-content'\r\n      overlayClassName='result-overlay'\r\n      ><div className='result-score'>Your score: {this.props.score}</div>\r\n      <div className='result-controls'>\r\n        <div className='result-close' onClick={this.props.close}>Close</div>\r\n        <a className='result-tweet' href={`https://twitter.com/intent/tweet?text=${this.renderText()}&url=https%3A%2F%2Fmajiang.github.io%2Fmj%2Fqys%2F&hashtags=qysmj&related=__DaLong`}><div>Tweet</div></a>\r\n      </div>\r\n    </Modal>;\r\n  }\r\n}\r\n\r\nfunction formatDigits(n: number, d: number)\r\n{\r\n  const s = n.toString();\r\n  const l = s.length;\r\n  return <><span className=\"transparent\">{\"0\".repeat(d-l)}</span>{n}</>;\r\n}\r\n","import { createLogic as _createLogic, Logic, StandardAction } from 'redux-logic';\r\nimport { ActionCreator, isType } from 'typescript-fsa';\r\nimport { Dispatch, Done } from 'redux-logic-helper';\r\n\r\ntype Type = string;\r\ntype Object = object | undefined;\r\nexport function createLogic<\r\n  State extends object,\r\n  Payload extends Object = undefined,\r\n  Meta extends Object = undefined,\r\n  Dependency extends object = {},\r\n  Context extends Object = undefined,\r\n  Action extends StandardAction<Type, Payload, Meta> = StandardAction<Type, Payload, Meta>,\r\n>(actionCreator: ActionCreator<Payload>, config: {process: any, latest? : boolean, warnTimeout? : number}):\r\nLogic<State, any, any, Dependency, Context, Type>\r\n{\r\n  return _createLogic<State, any, any, Dependency, Context, Type, Action>({\r\n    ...config,\r\n    type: actionCreator.type,\r\n    process({ action, getState }: { action: any, getState?: () => State }, dispatch: Dispatch, done: Done){\r\n      if (!isType(action, actionCreator)) throw new TypeError();\r\n      config.process({action, getState}, dispatch, done);\r\n    },\r\n    validate: undefined,\r\n    transform: undefined,\r\n  });\r\n}\r\n","import { createLogicMiddleware } from 'redux-logic';\r\nimport { createLogic } from './redux-logic-helper';\r\nimport { Dispatch, Done, ActionOf, PayloadOf } from 'redux-logic-helper';\r\nimport { applyMiddleware, createStore, AnyAction } from 'redux';\r\nimport { actionCreatorFactory } from 'typescript-fsa';\r\nimport { reducerWithInitialState } from 'typescript-fsa-reducers';\r\nimport { fromTiles, Validator } from './hu';\r\nimport { Deal, discardTile, drawTile, dealHand, sortHand } from './deal';\r\nimport { Messages, appendMessage } from './gamecommon';\r\nconst actionCreator = actionCreatorFactory();\r\n\r\ntype NullGame =\r\n{\r\n  kind: 'null',\r\n};\r\ntype PlayingGame =\r\n{\r\n  kind: 'playing',\r\n  deal: Deal,\r\n  score: number,\r\n  started: Date,\r\n};\r\ntype FinishedGame =\r\n{\r\n  kind: 'finished',\r\n  score: number,\r\n};\r\n\r\nexport type GameState = {\r\n  game: NullGame | PlayingGame | FinishedGame,\r\n  messages: Messages,\r\n};\r\nconst nullGame: GameState =\r\n{\r\n  game: {kind: 'null'},\r\n  messages: [],\r\n};\r\nfunction transitionPlaying(f: (deal: Deal) => Deal): (state: GameState) => GameState\r\n{\r\n  return (state: GameState) =>\r\n  {\r\n    if (state.game.kind !== 'playing')\r\n      throw new TypeError();\r\n    return {...state,\r\n      game: {...state.game,\r\n        deal: f(state.game.deal),\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport const gameActions = {\r\n  appendMessage: actionCreator<{message: string}>('appendMessage'),\r\n  discard: actionCreator<{position: number}>('discard'),\r\n  draw: actionCreator<{}>('draw'),\r\n  discardAndDraw: actionCreator<{position: number, timeBeforeDraw: number, timeBeforeSort: number}>('discardAndDraw'),\r\n  declareHu: actionCreator<{next: Deal, validator: Validator, timeBeforeDraw: number, timeBeforeSort: number}>('declareHu'),\r\n  deal: actionCreator<{deal: Deal}>('deal'),\r\n  dealAndDraw: actionCreator<{deal: Deal, timeBeforeDraw: number, timeBeforeSort: number}>('dealAndDraw'),\r\n  resetGame: actionCreator<({first: Deal, timeBeforeDraw: number, timeBeforeSort: number, timeOfGame: number})>('resetGame'),\r\n  newGame: actionCreator<({deal: Deal})>('newGame'),\r\n  newGameAndDraw: actionCreator<({deal: Deal, timeBeforeDraw: number, timeBeforeSort: number})>('newGameAndDraw'),\r\n  sort: actionCreator<{}>('sort'),\r\n  sortAndDraw: actionCreator<{timeBetweenSortDraw: number}>('sortAndDraw'),\r\n  scoreHu: actionCreator<{time: Date, tbd: number}>('scoreHu'),\r\n  scoreCuohu: actionCreator<{}>('scoreCuohu'),\r\n  finish: actionCreator<{}>('finish'),\r\n  nullGame: actionCreator<{}>('nullGame'),\r\n};\r\n\r\nconst gameReducer = reducerWithInitialState(nullGame)\r\n.case(gameActions.discard, (state, payload) =>\r\n  transitionPlaying((deal) => discardTile(deal, payload.position))(state)\r\n)\r\n.case(gameActions.draw, (state, _) =>\r\n  transitionPlaying(drawTile)(state)\r\n)\r\n.case(gameActions.deal, (state, payload) =>\r\n  transitionPlaying((deal) => dealHand(payload.deal))(state)\r\n)\r\n.case(gameActions.sort, (state, _) =>\r\n  transitionPlaying(sortHand)(state)\r\n)\r\n.case(gameActions.newGame, (_, payload) => ({\r\n  game:\r\n  {\r\n    kind: 'playing',\r\n    deal: payload.deal,\r\n    score: 0,\r\n    started: payload.deal.started\r\n  },\r\n  messages: appendMessage([], `new game started at ${payload.deal.started}`),\r\n}))\r\n.case(gameActions.appendMessage, (state, payload) => ({...state,\r\n  messages: appendMessage(state.messages, payload.message)\r\n}))\r\n.case(gameActions.scoreHu, (state, payload) => {\r\n  if (state.game.kind !== 'playing') throw new TypeError();\r\n  return {...state,\r\n    game: {...state.game,\r\n      score: state.game.score + Math.sqrt(payload.tbd / (payload.time.valueOf() - state.game.deal.started.valueOf())),\r\n    }\r\n  };\r\n})\r\n.case(gameActions.scoreCuohu, (state, _) => {\r\n  if (state.game.kind !== 'playing') throw new TypeError();\r\n  return {...state,\r\n    game: {...state.game,\r\n      score: state.game.score - 1\r\n    }};\r\n})\r\n.case(gameActions.finish, (state, payload) => {\r\n  if (state.game.kind !== 'playing') throw new TypeError();\r\n  console.log(`finish at: ${new Date()}`);\r\n  console.log(state);\r\n  console.log(payload);\r\n  return {game: {kind: 'finished', score: state.game.score}, messages:\r\n  appendMessage([], `finish! score: ${~~(state.game.score * 1000)}`),\r\n};})\r\n.case(gameActions.nullGame, (state, _) => ({\r\n  ...state,\r\n  game: {kind: 'null'}\r\n}))\r\n;\r\n\r\nfunction dispatchWaitDispatch(firstAction: AnyAction, waitTimeMs: number, secondAction: AnyAction, dispatch: Dispatch, done: Done)\r\n{\r\n  dispatch(firstAction);\r\n  setTimeout(() => {\r\n    dispatch(secondAction);\r\n    done();\r\n  }, waitTimeMs);\r\n}\r\n\r\nfunction dispatchSequence(actions: AnyAction[], dispatch: Dispatch, done: Done)\r\n{\r\n  actions.forEach(action => {\r\n    dispatch(action);\r\n  });\r\n  done();\r\n}\r\n\r\nconst discardAndDrawLogic = createLogic<GameState, PayloadOf<typeof gameActions.discardAndDraw>>(\r\n  gameActions.discardAndDraw,\r\n  {\r\n    process({ action }: { action: ActionOf<typeof gameActions.discardAndDraw>}, dispatch: Dispatch, done: Done)\r\n    {\r\n      const [waitTimeMs, nextAction] = (action.payload.timeBeforeSort <= action.payload.timeBeforeDraw)\r\n        ? [action.payload.timeBeforeSort, gameActions.sortAndDraw({timeBetweenSortDraw: action.payload.timeBeforeDraw - action.payload.timeBeforeSort})]\r\n        : [action.payload.timeBeforeDraw, gameActions.draw({})];\r\n      dispatchWaitDispatch(\r\n        gameActions.discard({position: action.payload.position}),\r\n        waitTimeMs, nextAction,\r\n        dispatch, done);\r\n    }\r\n  });\r\nconst dealAndDrawLogic = createLogic(\r\n  gameActions.dealAndDraw,\r\n  {\r\n    process({ action }: { action: ActionOf<typeof gameActions.dealAndDraw> }, dispatch: Dispatch, done: Done)\r\n    {\r\n      console.log(action);\r\n      const [waitTimeMs, nextAction] = (action.payload.timeBeforeSort <= action.payload.timeBeforeDraw)\r\n        ? [action.payload.timeBeforeSort, gameActions.sortAndDraw({timeBetweenSortDraw: action.payload.timeBeforeDraw - action.payload.timeBeforeSort})]\r\n        : [action.payload.timeBeforeDraw, gameActions.draw({})];\r\n      dispatchWaitDispatch(\r\n        gameActions.deal({deal: action.payload.deal}),\r\n        waitTimeMs, nextAction,\r\n        dispatch, done);\r\n    }\r\n  });\r\nconst sortAndDrawLogic = createLogic(\r\n  gameActions.sortAndDraw,\r\n  {\r\n    process({ action }: { action: ActionOf<typeof gameActions.sortAndDraw> }, dispatch: Dispatch, done: Done)\r\n    {\r\n      dispatchWaitDispatch(\r\n        gameActions.sort({}),\r\n        action.payload.timeBetweenSortDraw,\r\n        gameActions.draw({}),\r\n        dispatch, done);\r\n    }\r\n  });\r\nconst newGameAndDrawLogic = createLogic(\r\n  gameActions.newGameAndDraw,\r\n  {\r\n    process({ action }: { action: ActionOf<typeof gameActions.newGameAndDraw> }, dispatch: Dispatch, done: Done)\r\n    {\r\n      const [waitTimeMs, nextAction] = (action.payload.timeBeforeSort <= action.payload.timeBeforeDraw)\r\n        ? [action.payload.timeBeforeSort, gameActions.sortAndDraw({timeBetweenSortDraw: action.payload.timeBeforeDraw - action.payload.timeBeforeSort})]\r\n        : [action.payload.timeBeforeDraw, gameActions.draw({})];\r\n      dispatchWaitDispatch(\r\n        gameActions.newGame({deal: action.payload.deal}),\r\n        waitTimeMs,\r\n        nextAction,\r\n        dispatch, done);\r\n    }\r\n  }\r\n);\r\nconst resetGamelogic = createLogic(\r\n  gameActions.resetGame,\r\n  {\r\n    latest: true,\r\n    warnTimeout: 0,\r\n    process({ action }: { action: ActionOf<typeof gameActions.resetGame> }, dispatch: Dispatch, done: Done)\r\n    {\r\n      console.log(action.payload);\r\n      dispatchWaitDispatch(\r\n        gameActions.newGameAndDraw({\r\n          deal: action.payload.first,\r\n          timeBeforeDraw: action.payload.timeBeforeDraw,\r\n          timeBeforeSort: action.payload.timeBeforeSort,\r\n        }),\r\n        action.payload.timeOfGame,\r\n        gameActions.finish({}),\r\n        dispatch, done);\r\n      console.log(`${new Date()}`);\r\n    }\r\n  });\r\nconst declareHuLogic = createLogic(\r\n  gameActions.declareHu,\r\n  {\r\n    process({ action, getState }: { action: ActionOf<typeof gameActions.declareHu>, getState: () => GameState }, dispatch: Dispatch, done: Done)\r\n    {\r\n      const state = getState();\r\n      if (state.game.kind !== 'playing') throw new TypeError();\r\n      const hu = action.payload.validator(fromTiles(state.game.deal.hand));\r\n      const firstAction = hu\r\n        ? gameActions.scoreHu({time: action.payload.next.started, tbd: action.payload.timeBeforeDraw})\r\n        : gameActions.scoreCuohu({});\r\n      dispatchSequence([\r\n        firstAction,\r\n        gameActions.appendMessage({message: `declared ${hu} hu`}),\r\n        gameActions.dealAndDraw({\r\n          deal: action.payload.next,\r\n          timeBeforeDraw: action.payload.timeBeforeDraw,\r\n          timeBeforeSort: action.payload.timeBeforeSort,\r\n        })], dispatch, done);\r\n    }\r\n  });\r\nconst logics = [\r\n  discardAndDrawLogic,\r\n  dealAndDrawLogic,\r\n  resetGamelogic,\r\n  sortAndDrawLogic,\r\n  declareHuLogic,\r\n  newGameAndDrawLogic,\r\n];\r\nexport const gameStore = createStore(gameReducer, applyMiddleware(createLogicMiddleware(logics)));\r\n","import React from 'react';\nimport { connect, Provider } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport { Game } from './components';\nimport { gameActions, gameStore } from './gamelogics';\nimport { shufflePile } from './gamecommon';\nimport './App.css';\n\nconst ConnectedGame = connect(\n    (storeState) => (storeState),\n    (dispatch) => ({actions: bindActionCreators(gameActions, dispatch)}),\n)(Game);\n\nfunction App() {\n  return (\n    <Provider store={gameStore}>\n      <ConnectedGame initializer={shufflePile} />\n    </Provider>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}